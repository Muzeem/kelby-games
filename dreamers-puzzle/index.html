<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A contemplative jigsaw puzzle game exploring pivotal moments that changed human history.">
    <meta name="theme-color" content="#c9a227">
    <meta name="msapplication-TileColor" content="#1a1a2e">
    <meta name="msapplication-TileImage" content="icons/icon-144.png">
    <title>Dreamers Puzzle</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&family=Playfair+Display:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <div id="intro-screen" class="screen active">
            <div class="intro-content">
                <p class="intro-text" data-delay="0">What can an ordinary human, living on a small rock drifting through infinite space, truly do?</p>
                <p class="intro-text" data-delay="4000">Almost nothing.</p>
                <p class="intro-text" data-delay="7000">And yet, sometimes, one human changes how the universe behaves. Questions what is accepted. Bends reality. Breaks barriers.</p>
                <button id="begin-btn" class="cta-btn" data-delay="11000">Begin</button>
            </div>
        </div>

        <div id="selection-screen" class="screen">
            <h1 class="screen-title">Choose a Moment</h1>
            <div id="puzzle-grid" class="puzzle-grid"></div>
        </div>

        <div id="difficulty-screen" class="screen">
            <h1 class="screen-title">Select Difficulty</h1>
            <div class="difficulty-options">
                <button class="difficulty-btn" data-pieces="12">Easy<span class="piece-count">12 pieces</span></button>
                <button class="difficulty-btn" data-pieces="24">Medium<span class="piece-count">24 pieces</span></button>
                <button class="difficulty-btn" data-pieces="48">Hard<span class="piece-count">48 pieces</span></button>
            </div>
        </div>

        <div id="puzzle-screen" class="screen">
            <div class="puzzle-header">
                <h2 id="puzzle-hint" class="puzzle-hint"></h2>
                <div class="puzzle-controls">
                    <button id="restart-btn" class="control-btn">Restart</button>
                    <button id="change-difficulty-btn" class="control-btn">Difficulty</button>
                    <button id="choose-another-btn" class="control-btn">Back</button>
                </div>
            </div>
            <div class="puzzle-container">
                <div class="puzzle-area">
                    <div id="puzzle-board" class="puzzle-board">
                        <div class="puzzle-board-inner">
                            <canvas id="background-image" class="background-image"></canvas>
                            <canvas id="board-grid" class="board-grid"></canvas>
                            <div id="pieces-container"></div>
                        </div>
                    </div>
                </div>
                <div class="pieces-tray">
                    <div class="tray-header">
                        <h3>Pieces <span id="pieces-remaining"></span></h3>
                    </div>
                    <div id="tray-content"></div>
                </div>
            </div>
        </div>

        <div id="completion-screen" class="screen">
            <div class="completion-content">
                <div id="completed-image" class="completed-image"></div>
                <h2 id="revelation-title" class="revelation-title"></h2>
                <p id="revelation-text" class="revelation-text"></p>
                <button id="continue-btn" class="cta-btn visible">Choose Another Moment</button>
            </div>
            <canvas id="celebration-canvas"></canvas>
        </div>
    </div>


    <audio id="background-music" loop preload="auto">
        <source src="sounds/background.mp3" type="audio/mpeg">
    </audio>
    <audio id="celebration-sound" preload="auto">
        <source src="sounds/celebration.mp3" type="audio/mpeg">
    </audio>

    <script src="puzzles-data.js"></script>
    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/games/dreamers-puzzle/sw.js')
                    .then(reg => {
                        console.log('Service Worker registered successfully:', reg);
                    })
                    .catch(err => {
                        console.error('Service Worker registration failed:', err);
                    });
            });
        } else {
            console.warn('Service Workers not supported in this browser');
        }
    </script>
</body>
</html>
